<div 
  [class.is-expanded-wrapper]="isExpanded()"
  [class.p-4]="isExpanded()"
  [class.sm:p-8]="isExpanded()"
  (click)="isExpanded() && toggleExpand()">

  <div 
    class="python-console-wrapper font-mono text-sm bg-[#0d1117] border border-gray-700 rounded-lg shadow-2xl overflow-hidden flex flex-col"
    [class.is-expanded-content]="isExpanded()"
    (click)="isExpanded() && $event.stopPropagation()">
    <!-- Header -->
    <div class="bg-gray-800 px-4 py-2 flex items-center justify-between border-b border-gray-700 shrink-0">
      <div class="flex gap-2">
        <div class="w-3 h-3 rounded-full bg-red-500 hover:bg-red-600 transition-colors cursor-pointer" (click)="clear()" title="Limpar Console"></div>
        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
        <div class="w-3 h-3 rounded-full bg-green-500"></div>
      </div>
      
      <button (click)="runCode()" [disabled]="isRunning()" class="run-button">
          @if(isRunning()) {
              <span class="material-icons-outlined text-sm animate-spin">sync</span>
              Executando...
          } @else {
              <span class="material-icons-outlined text-sm">play_arrow</span>
              Run
          }
      </button>
  
      <div class="w-10 flex justify-end">
        <button (click)="toggleExpand()" class="text-gray-500 hover:text-white transition-colors" [title]="isExpanded() ? 'Recolher' : 'Expandir'">
          <span class="material-icons-outlined text-base">
            {{ isExpanded() ? 'close_fullscreen' : 'open_in_full' }}
          </span>
        </button>
      </div>
    </div>
  
    <!-- Main Area (Code + Output) -->
    <div class="flex flex-1 min-h-0" 
         [class.flex-col]="!isExpanded()"
         [class.lg:flex-row]="isExpanded()">
      <!-- Code Input Area -->
      <div class="code-input-area border-gray-700"
           [class.border-b]="!isExpanded()"
           [class.lg:w-1/2]="isExpanded()"
           [class.lg:border-b-0]="isExpanded()"
           [class.lg:border-r]="isExpanded()">
          <textarea 
              class="code-textarea"
              [class.lg:text-sm]="isExpanded()"
              [(ngModel)]="codeToRun"
              spellcheck="false"
              placeholder="Seu cÃ³digo Python aqui..."
          ></textarea>
      </div>
  
      <!-- Output Area -->
      <div #terminalOutput class="output-area" 
           [style.height]="!isExpanded() ? outputHeight() : null"
           [class.lg:w-1/2]="isExpanded()">
          @for (line of lines(); track $index) {
          <div class="mb-1 break-words leading-tight">
              @switch (line.type) {
              @case ('input') {
                  <span class="text-gray-400 mr-2">{{ line.content }}</span>
              }
              @case ('output') {
                  <span class="text-green-400">{{ line.content }}</span>
              }
              @case ('error') {
                  <span class="text-red-400 whitespace-pre-wrap">{{ line.content }}</span>
              }
              @case ('info') {
                  <span class="text-gray-500 italic">{{ line.content }}</span>
              }
              }
          </div>
          }
      </div>
    </div>
  </div>

</div>
