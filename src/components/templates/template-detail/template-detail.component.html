<div>
  @if(!template()) {
    <p class="text-center text-gray-400">Carregando template...</p>
  } @else {
    @if(template(); as t) {
      <div class="flex flex-col lg:flex-row gap-8">
        <!-- Main Content: Workflow View -->
        <div class="flex-grow lg:w-3/4">
          <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight mb-4">{{ t.title }}</h1>
          <div class="aspect-video w-full bg-gray-900 border border-gray-800 rounded-lg overflow-hidden relative">
            @if(workflowData()) {
              <n8n-workflow-view #workflowView [options]="viewOptions"></n8n-workflow-view>
            } @else {
              <div class="flex items-center justify-center h-full text-center text-gray-500 p-4">
                Visualização indisponível. O JSON do workflow pode ser inválido ou não foi fornecido.
              </div>
            }
             <div class="absolute bottom-2 right-2 bg-gray-950/50 backdrop-blur-sm p-1 rounded-md text-xs text-gray-400">
              Use o scroll para zoom e clique e arraste para mover.
            </div>
          </div>
        </div>

        <!-- Sidebar: Info and Actions -->
        <div class="lg:w-1/4 flex-shrink-0">
          <div class="p-6 bg-gray-900 border border-gray-800 rounded-lg space-y-6 sticky top-8">
            <div>
              <h2 class="text-lg font-semibold text-white">Sobre este Template</h2>
              <p class="mt-2 text-sm text-gray-400">{{ t.description }}</p>
            </div>
             @if(t.author) {
              <div>
                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Autor</h3>
                <div class="flex items-center gap-2 mt-2">
                   <div class="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center text-sm font-bold text-white uppercase flex-shrink-0 overflow-hidden">
                      @if(t.author.avatar_url; as avatarUrl) {
                          <img [src]="avatarUrl" [alt]="t.author.username || ''" class="w-full h-full object-cover">
                      } @else {
                          {{ (t.author.username || '?')[0] }}
                      }
                  </div>
                  <span class="font-medium text-gray-300">{{ t.author.username }}</span>
                </div>
              </div>
            }
            <div>
              <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Como Usar</h3>
              <ol class="list-decimal list-inside text-sm text-gray-400 space-y-1 mt-2">
                <li>Clique no botão "Copiar Workflow" abaixo.</li>
                <li>Na sua instância n8n, vá em "Workflows".</li>
                <li>Clique em "Import from Clipboard" ou "Import from File" e cole.</li>
              </ol>
            </div>
            <button (click)="copyWorkflow()" [disabled]="!workflowData()" class="w-full px-4 py-3 bg-blue-accent text-white rounded-md font-semibold hover:bg-blue-accent/90 transition-colors flex items-center justify-center gap-2 disabled:opacity-50">
              <span class="material-icons-outlined">content_copy</span>
              {{ copyButtonText() }}
            </button>
          </div>
        </div>
      </div>
    } @else {
      <div class="text-center py-16">
        <h1 class="text-3xl font-bold text-white">Template não encontrado</h1>
        <p class="mt-2 text-gray-400">O template que você está procurando não existe ou foi movido.</p>
        <a routerLink="/templates" class="mt-6 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-accent hover:bg-blue-accent/90">
            Voltar para a Galeria
        </a>
    </div>
    }
  }
</div>
