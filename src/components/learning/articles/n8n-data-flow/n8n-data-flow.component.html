<div class="max-w-4xl mx-auto">
  <header class="mb-12">
    <div class="text-sm text-gray-400 mb-3 flex items-center gap-2">
      <a routerLink="/learning" class="hover:text-blue-accent hover:underline">Trilhas de Aprendizagem</a>
      <span class="material-icons-outlined text-base">chevron_right</span>
      <a routerLink="/learning/n8n-basico" class="hover:text-blue-accent hover:underline">n8n Básico</a>
    </div>
    <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight">Fluxo de Dados e Expressões no n8n</h1>
    <p class="mt-4 text-lg text-gray-400">Aprenda como os dados fluem entre os nós e como usar expressões para acessar informações de passos anteriores.</p>
  </header>

  <article class="prose-container space-y-10">
    <div class="p-6 bg-gray-900 border border-gray-800 rounded-lg">
      <h2 class="text-2xl font-semibold text-white !mt-0">A Analogia da Esteira de Produção</h2>
      <p>
        Imagine um workflow do n8n como uma esteira de produção em uma fábrica. Cada nó é uma estação de trabalho. Um "item" (um pacote de dados) entra na esteira e passa por cada estação, onde é modificado, verificado ou usado para acionar outra ação.
      </p>
      <p>
        O conceito mais importante é que cada nó recebe os dados do nó anterior, faz seu trabalho e passa o resultado para o próximo. O n8n gerencia esse fluxo de dados para você.
      </p>
    </div>

    <div>
      <h2 class="text-2xl font-semibold text-white">A Estrutura de Dados: Itens e `$json`</h2>
      <p>
        Os dados no n8n são passados como uma lista de <strong>itens</strong>. Cada item é um objeto que contém uma propriedade especial chamada <code>json</code>. É dentro de <code>$json</code> que os dados principais daquele item vivem.
      </p>
       <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg">
        <h4 class="text-sm font-semibold text-gray-300 mb-2">Exemplo: Dados de um Webhook</h4>
        <p class="text-xs text-gray-400">Se um webhook envia um JSON, o n8n o recebe e o coloca dentro de <code>$json</code>.</p>
        <pre class="!bg-gray-900 !p-3 !my-0"><code class="language-json">[
  {{ '{' }}
    "json": {{ '{' }}
      "nome": "Ana Silva",
      "pedido_id": 123,
      "valor": 99.50
    {{ '}' }}
  {{ '}' }}
]</code></pre>
        <p class="text-xs text-gray-400 mt-2">Isso representa uma lista com <strong>um item</strong>. O conteúdo do JSON que o webhook enviou está dentro da chave <code>"json"</code>.</p>
      </div>
    </div>
    
    <div>
      <h2 class="text-2xl font-semibold text-white">Expressões: A Chave para Dados Dinâmicos</h2>
      <p>
        OK, os dados estão lá. Mas como usamos o nome "Ana Silva" em um nó posterior para enviar um e-mail? Usando <strong>Expressões</strong>.
      </p>
      <p>
        Uma expressão é um pequeno pedaço de código JavaScript envolvido por chaves duplas <code>{{ '{{' }} ... {{ '}}' }}</code>. Ela permite que você acesse dinamicamente os dados que estão fluindo pelo workflow.
      </p>
      <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg">
        <h4 class="text-sm font-semibold text-gray-300 mb-2">Acessando Dados do Nó Atual</h4>
        <p class="text-xs text-gray-400">Para acessar o nome do cliente do exemplo anterior, você usaria:</p>
        <pre class="!bg-gray-900 !p-3 !my-2"><code class="language-javascript">{{ '{{' }} $json.nome {{ '}}' }}</code></pre>
        <p class="text-sm text-gray-400 mt-1">O n8n substitui essa expressão pelo valor real, que é "Ana Silva".</p>
      </div>
    </div>

    <div>
      <h2 class="text-2xl font-semibold text-white">Acessando Dados de Nós Anteriores</h2>
      <p>
        E se você precisar de um dado de um nó que não seja o imediatamente anterior? Você pode "voltar no tempo" usando a variável <code>$items()</code>.
      </p>
       <div class="p-4 bg-gray-800 border border-gray-700 rounded-lg">
        <h4 class="text-sm font-semibold text-gray-300 mb-2">Exemplo: Pegando o ID do Webhook</h4>
        <p class="text-xs text-gray-400">Imagine que você tem um nó "Webhook" seguido por um "Set" e depois um "HTTP Request". Dentro do nó "HTTP Request", você quer usar o ID do pedido que veio lá do Webhook. Você faria:</p>
        <pre class="!bg-gray-900 !p-3 !my-2"><code class="language-javascript">{{ '{{' }} $items("Webhook").first().json.pedido_id {{ '}}' }}</code></pre>
         <ul class="!list-none !pl-0 space-y-2 text-sm mt-2 text-gray-400">
            <li><code class="text-cyan-300">$items("Webhook")</code>: Pega a lista de todos os itens que saíram do nó chamado "Webhook".</li>
            <li><code class="text-cyan-300">.first()</code>: Como <code>$items</code> retorna uma lista, usamos <code>.first()</code> para pegar o primeiro item (o mais comum).</li>
            <li><code class="text-cyan-300">.json.pedido_id</code>: Acessamos o <code>json</code> daquele item e, dentro dele, a propriedade <code>pedido_id</code>.</li>
        </ul>
      </div>
    </div>
    
    <div class="p-6 bg-green-900/30 border border-green-700/50 text-green-300 rounded-lg">
      <h3 class="font-semibold text-green-200 text-lg mb-2">Conclusão: O "Fio Condutor"</h3>
      <p>
        O fluxo de dados e as expressões são o fio condutor que une seu workflow. Entender que os dados são passados em <strong>itens</strong> e que você usa <code>{{ '{{' }} $json.propriedade {{ '}}' }}</code> para acessar os dados do passo atual é 90% do que você precisa para criar automações dinâmicas e poderosas.
      </p>
       <div class="mt-4">
        <a routerLink="/tools/n8n-expression-simulator" class="inline-flex items-center gap-2 px-4 py-2 bg-green-accent/20 text-white rounded-md font-semibold hover:bg-green-accent/30 transition-colors">
          <span class="material-icons-outlined">construction</span>
          Pratique agora no Simulador de Expressões
        </a>
      </div>
    </div>

    <div class="pt-8 text-center">
       <a routerLink="/learning/n8n-basico" class="inline-flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-md font-semibold hover:bg-gray-600 transition-colors">
        <span class="material-icons-outlined">arrow_forward</span>
        Próximo Passo: Manipulando Dados com o Nó "Set"
      </a>
    </div>
  </article>
</div>
