<div class="max-w-4xl mx-auto">
  <header class="mb-12">
    <div class="text-sm text-gray-400 mb-3 flex items-center gap-2">
      <a routerLink="/learning" class="hover:text-blue-accent hover:underline">Trilhas de Aprendizagem</a>
      <span class="material-icons-outlined text-base">chevron_right</span>
      <a routerLink="/learning/python-machine-learning-sklearn" class="hover:text-blue-accent hover:underline">Introdução ao Machine Learning com Scikit-learn</a>
    </div>
    <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight">Laboratório: Avaliando a Performance do Modelo</h1>
    <p class="mt-4 text-lg text-gray-400">Desenvolva uma intuição sobre as métricas de regressão ajustando um modelo em tempo real e entenda o trade-off de viés vs. variância.</p>
  </header>
  <article class="prose-container space-y-16">
    <div class="p-6 bg-gray-900 border border-gray-800 rounded-lg">
      <h2 class="text-2xl font-semibold text-white !mt-0">Por que Avaliar? A Prova dos Nove</h2>
      <p>
        No artigo anterior, treinamos um modelo e vimos que suas previsões pareciam "próximas" dos valores reais. Mas em Machine Learning, "próximo" não é suficiente. Precisamos de números objetivos — <strong>métricas</strong> — para quantificar o quão bom (ou ruim) nosso modelo realmente é.
      </p>
    </div>
    
    <!-- INTERACTIVE LAB -->
    <section>
      <h2 class="text-2xl font-semibold text-white mb-4">1. Laboratório Interativo: Desenvolvendo a Intuição</h2>
      <p class="text-gray-300 mb-6">
        Abaixo temos um conjunto de pontos de dados (em azul). Sua tarefa é ajustar a linha de regressão (em branco) para que ela se encaixe o melhor possível nos pontos. Observe como as métricas mudam à medida que você ajusta os controles. As linhas vermelhas mostram o "erro" de cada ponto.
      </p>

      <div class="p-6 bg-gray-900 border border-gray-800 rounded-xl">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Controls -->
          <div class="space-y-6">
              <div>
                <label class="flex justify-between text-xs text-gray-400 mb-1">
                  <span>Inclinação (Slope / m)</span> <span class="font-mono">{{ slope().toFixed(2) }}</span>
                </label>
                <input type="range" min="0" max="2" step="0.01" [ngModel]="slope()" (ngModelChange)="slope.set(+$event)" class="w-full slider-thumb accent-blue-500">
              </div>
              <div>
                <label class="flex justify-between text-xs text-gray-400 mb-1">
                  <span>Intercepto (c)</span> <span class="font-mono">{{ intercept().toFixed(1) }}</span>
                </label>
                <input type="range" min="-20" max="20" step="0.5" [ngModel]="intercept()" (ngModelChange)="intercept.set(+$event)" class="w-full slider-thumb accent-blue-500">
              </div>

              <!-- Metrics Display -->
              <div class="pt-4 border-t border-gray-700 space-y-3">
                  <div class="flex justify-between items-baseline p-2 bg-gray-800 rounded">
                      <span class="text-sm font-bold text-white">R² (R-squared)</span>
                      <span class="font-mono text-lg font-bold" [class.text-green-400]="r2() > 0.9" [class.text-yellow-400]="r2() > 0.5 && r2() <= 0.9" [class.text-red-400]="r2() <= 0.5">{{ r2().toFixed(3) }}</span>
                  </div>
                  <div class="flex justify-between items-baseline p-2">
                      <span class="text-sm text-gray-400">MAE</span>
                      <span class="font-mono text-sm text-gray-300">{{ mae().toFixed(2) }}</span>
                  </div>
                   <div class="flex justify-between items-baseline p-2">
                      <span class="text-sm text-gray-400">RMSE</span>
                      <span class="font-mono text-sm text-gray-300">{{ rmse().toFixed(2) }}</span>
                  </div>
              </div>
          </div>

          <!-- SVG Chart -->
          <div class="bg-black/30 rounded-lg border border-gray-700 p-2">
              <svg viewBox="0 0 100 100" class="w-full h-auto">
                  <!-- Grid lines -->
                  @for (i of [20, 40, 60, 80]; track i) {
                      <line [attr.x1]="i" y1="0" [attr.x2]="i" y2="100" stroke="#374151" stroke-width="0.5" />
                      <line x1="0" [attr.y1]="i" x2="100" [attr.y2]="i" stroke="#374151" stroke-width="0.5" />
                  }

                  <!-- Error Lines -->
                  @for (p of predictions(); track p.x) {
                      <line [attr.x1]="p.x" [attr.y1]="100 - p.y" [attr.x2]="p.x" [attr.y2]="100 - p.predictedY" stroke="#ef4444" stroke-width="1" stroke-dasharray="2 2" />
                  }

                  <!-- Data Points -->
                  @for (p of points; track p.x) {
                      <circle [attr.cx]="p.x" [attr.cy]="100 - p.y" r="2" fill="#3b82f6" />
                  }
                  
                  <!-- Regression Line -->
                  <path [attr.d]="linePath()" stroke="white" stroke-width="1.5" />
              </svg>
          </div>
        </div>
      </div>
    </section>

    <!-- Metrics Explanation -->
    <section>
      <h2 class="text-2xl font-semibold text-white">2. Métricas de Regressão em Detalhe</h2>
       <div class="space-y-6">
        <div class="metric-card">
          <h4 class="metric-title">Erro Absoluto Médio (MAE)</h4>
          <p class="metric-desc"><strong>O que é:</strong> A média da distância vertical (o "erro") entre cada ponto e a linha de previsão, ignorando se o erro é positivo ou negativo. É a média do comprimento das linhas vermelhas no gráfico.</p>
          <div class="metric-formula">
            <pre><code>MAE = (1/n) * Σ |y_real - y_previsto|</code></pre>
          </div>
          <p class="metric-intuition"><strong>Intuição:</strong> "Em média, minhas previsões estão erradas por X unidades." É fácil de entender e está na mesma unidade do seu alvo (ex: R$ 50.000 de erro na previsão de uma casa).</p>
        </div>

        <div class="metric-card">
          <h4 class="metric-title">Raiz do Erro Quadrático Médio (RMSE)</h4>
          <p class="metric-desc"><strong>O que é:</strong> Similar ao MAE, mas antes de tirar a média, ele eleva cada erro ao quadrado. No final, tira a raiz quadrada para voltar à unidade original.</p>
          <div class="metric-formula">
            <pre><code>RMSE = sqrt((1/n) * Σ (y_real - y_previsto)²)</code></pre>
          </div>
          <p class="metric-intuition"><strong>Intuição:</strong> "RMSE penaliza erros grandes muito mais do que o MAE." Se você tem um ponto muito longe da linha (um outlier), o RMSE será significativamente maior que o MAE. É útil quando erros grandes são especialmente indesejáveis.</p>
        </div>

        <div class="metric-card">
          <h4 class="metric-title">Coeficiente de Determinação (R²)</h4>
          <p class="metric-desc"><strong>O que é:</strong> A métrica mais importante para regressão. Ela mede a proporção da variância na variável dependente que é previsível a partir das variáveis independentes. Varia de 0 a 1 (ou pode ser negativa se o modelo for pior que a média).</p>
           <div class="metric-formula">
            <pre><code>R² = 1 - (Soma dos Erros ao Quadrado / Soma Total ao Quadrado)</code></pre>
          </div>
          <p class="metric-intuition"><strong>Intuição:</strong> "Meu modelo explica X% da variação nos dados." Um R² de <strong>0.85</strong> significa que 85% da variação nos preços das casas pode ser explicada pelas features do seu modelo (área, quartos, etc.). Quanto mais perto de 1, melhor o modelo se ajusta aos dados.</p>
        </div>
      </div>
    </section>

    <!-- Bias-Variance Tradeoff -->
    <section>
      <h2 class="text-2xl font-semibold text-white">3. O Conceito Mais Importante: Viés vs. Variância</h2>
      <p class="text-gray-300 mb-6">
        Um bom modelo não é apenas aquele que acerta os dados de treino, mas aquele que <strong>generaliza</strong> bem para dados novos. O equilíbrio entre acertar o padrão e não "decorar" o ruído é chamado de <strong>Trade-off de Viés-Variância</strong>. A analogia do alvo de dardos ajuda a entender.
      </p>

      <div class="bias-variance-grid">
        <div class="target-container">
          <h4 class="target-title">Baixo Viés, Baixa Variância (Ideal)</h4>
          <div class="target">
            <div class="target-rings"></div>
            <div class="shot" style="top: 48%; left: 52%;"></div>
            <div class="shot" style="top: 55%; left: 45%;"></div>
            <div class="shot" style="top: 45%; left: 48%;"></div>
            <div class="shot" style="top: 51%; left: 55%;"></div>
          </div>
          <p class="target-desc">O modelo acerta o padrão e é consistente. Nossas previsões são precisas e confiáveis.</p>
        </div>
        <div class="target-container">
          <h4 class="target-title">Alto Viés, Baixa Variância (Underfitting)</h4>
          <div class="target">
            <div class="target-rings"></div>
            <div class="shot" style="top: 28%; left: 32%;"></div>
            <div class="shot" style="top: 35%; left: 25%;"></div>
            <div class="shot" style="top: 25%; left: 28%;"></div>
            <div class="shot" style="top: 31%; left: 35%;"></div>
          </div>
          <p class="target-desc">O modelo é consistente, mas erra consistentemente para o mesmo lado. Ele é muito simples e não capturou o padrão dos dados.</p>
        </div>
        <div class="target-container">
          <h4 class="target-title">Baixo Viés, Alta Variância (Overfitting)</h4>
          <div class="target">
            <div class="target-rings"></div>
            <div class="shot" style="top: 50%; left: 90%;"></div>
            <div class="shot" style="top: 10%; left: 50%;"></div>
            <div class="shot" style="top: 50%; left: 10%;"></div>
            <div class="shot" style="top: 90%; left: 50%;"></div>
          </div>
          <p class="target-desc">O modelo acerta "na média", mas suas previsões estão espalhadas. Ele é muito complexo e "decorou" o ruído dos dados de treino, não generalizando bem.</p>
        </div>
        <div class="target-container">
          <h4 class="target-title">Alto Viés, Alta Variância (Pior Caso)</h4>
          <div class="target">
            <div class="target-rings"></div>
            <div class="shot" style="top: 80%; left: 20%;"></div>
            <div class="shot" style="top: 15%; left: 70%;"></div>
            <div class="shot" style="top: 75%; left: 85%;"></div>
            <div class="shot" style="top: 25%; left: 10%;"></div>
          </div>
          <p class="target-desc">O modelo é inconsistente e erra o alvo. É inútil.</p>
        </div>
      </div>
    </section>
    
    <div class="pt-8 text-center">
       <a routerLink="/learning/python-machine-learning-sklearn" class="inline-flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-md font-semibold hover:bg-gray-600 transition-colors">
        <span class="material-icons-outlined">arrow_forward</span>
        Próximo Passo: Preparando Dados (Feature Engineering)
      </a>
    </div>
  </article>
</div>