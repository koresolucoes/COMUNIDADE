<div class="p-6" [class.bg-gray-900]="isEmbedded()">
  @if(!isEmbedded()) {
    <div class="mb-4">
      <h1 class="text-3xl md:text-4xl font-bold text-white">Gerador de CRON</h1>
      <p class="mt-2 text-gray-400">Crie expressões CRON de forma visual ou manual com feedback em tempo real.</p>
    </div>
  } @else {
     <h3 class="text-lg font-semibold text-white mb-4">Gerador de CRON</h3>
  }

  <!-- Toggle Switch -->
  <div class="flex items-center justify-end mb-4">
    <label for="advanced-mode-toggle" class="flex items-center cursor-pointer">
        <span class="mr-3 text-sm font-medium text-gray-400">Modo Avançado (Expressão)</span>
        <div class="relative">
            <input type="checkbox" id="advanced-mode-toggle" class="sr-only" [checked]="isAdvancedMode()" (change)="toggleMode()">
            <div class="toggle-bg block bg-gray-700 w-14 h-8 rounded-full transition-colors"></div>
            <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-all"></div>
        </div>
    </label>
  </div>

  @if (isAdvancedMode()) {
    <!-- Advanced Mode: Single Input -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-400 mb-1">Expressão CRON</label>
      <input 
        type="text"
        [ngModel]="cronExpressionInput()"
        (ngModelChange)="cronExpressionInput.set($event)"
        class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono"
        placeholder="* * * * *">
    </div>
  } @else {
    <!-- Simple Mode: Enhanced Inputs -->
    <div class="space-y-3 mb-6">
      <!-- Minute -->
      <div class="grid grid-cols-1 md:grid-cols-[100px_1fr_1fr] gap-x-4 gap-y-2 items-center p-3 bg-gray-900/50 rounded-lg">
        <label class="font-medium text-gray-300">Minuto</label>
        <select [ngModel]="minuteSelectionType()" (ngModelChange)="minuteSelectionType.set($event)" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
          <option value="every">A cada Minuto (*)</option>
          <option value="each">A cada 'X' Minutos (Passo)</option>
          <option value="range">Intervalo de Minutos</option>
          <option value="list">Minuto(s) Específico(s)</option>
        </select>
        <div class="min-h-[40px] flex items-center">
          @switch(minuteSelectionType()) {
            @case('each') {
              <div class="flex items-center gap-2 text-sm w-full">
                <span>A cada</span>
                <input type="number" min="1" max="59" [ngModel]="minuteEachValue()" (ngModelChange)="minuteEachValue.set(+$event)" class="w-20 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono text-center">
                <span>minutos</span>
              </div>
            }
            @case('range') {
              <div class="flex items-center gap-2 text-sm w-full">
                <select [ngModel]="minuteRangeStart()" (ngModelChange)="minuteRangeStart.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of minuteOptions; track i) { <option [value]="i">{{i}}</option> }
                </select>
                <span>até</span>
                <select [ngModel]="minuteRangeEnd()" (ngModelChange)="minuteRangeEnd.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of minuteOptions; track i) { <option [value]="i">{{i}}</option> }
                </select>
              </div>
            }
            @case('list') {
              <div class="w-full">
                <input type="text" [ngModel]="minuteListValue()" (ngModelChange)="minuteListValue.set($event)" placeholder="ex: 0,15,30" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono" [class.border-red-500]="minuteListError()">
                @if(minuteListError(); as error) {
                  <p class="text-xs text-red-400 mt-1">{{ error }}</p>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- Hour -->
      <div class="grid grid-cols-1 md:grid-cols-[100px_1fr_1fr] gap-x-4 gap-y-2 items-center p-3 bg-gray-900/50 rounded-lg">
        <label class="font-medium text-gray-300">Hora</label>
        <select [ngModel]="hourSelectionType()" (ngModelChange)="hourSelectionType.set($event)" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
          <option value="every">A cada Hora (*)</option>
          <option value="each">A cada 'X' Horas (Passo)</option>
          <option value="range">Intervalo de Horas</option>
          <option value="list">Hora(s) Específica(s)</option>
        </select>
        <div class="min-h-[40px] flex items-center">
          @switch(hourSelectionType()) {
            @case('each') {
              <div class="flex items-center gap-2 text-sm w-full">
                <span>A cada</span>
                <input type="number" min="1" max="23" [ngModel]="hourEachValue()" (ngModelChange)="hourEachValue.set(+$event)" class="w-20 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono text-center">
                <span>horas</span>
              </div>
            }
            @case('range') {
              <div class="flex items-center gap-2 text-sm w-full">
                <select [ngModel]="hourRangeStart()" (ngModelChange)="hourRangeStart.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of hourOptions; track i) { <option [value]="i">{{i}}</option> }
                </select>
                <span>até</span>
                <select [ngModel]="hourRangeEnd()" (ngModelChange)="hourRangeEnd.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of hourOptions; track i) { <option [value]="i">{{i}}</option> }
                </select>
              </div>
            }
            @case('list') {
              <div class="w-full">
                <input type="text" [ngModel]="hourListValue()" (ngModelChange)="hourListValue.set($event)" placeholder="ex: 9,12,18" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono" [class.border-red-500]="hourListError()">
                @if(hourListError(); as error) {
                  <p class="text-xs text-red-400 mt-1">{{ error }}</p>
                }
              </div>
            }
          }
        </div>
      </div>
      
      <!-- Day of Month -->
      <div class="grid grid-cols-1 md:grid-cols-[100px_1fr_1fr] gap-x-4 gap-y-2 items-center p-3 bg-gray-900/50 rounded-lg">
        <label class="font-medium text-gray-300">Dia do Mês</label>
        <select [ngModel]="dayOfMonthSelectionType()" (ngModelChange)="dayOfMonthSelectionType.set($event)" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
          <option value="every">Todo Dia (*)</option>
          <option value="each">A cada 'X' Dias (Passo)</option>
          <option value="range">Intervalo de Dias</option>
          <option value="list">Dia(s) Específico(s)</option>
        </select>
        <div class="min-h-[40px] flex items-center">
          @switch(dayOfMonthSelectionType()) {
            @case('each') {
              <div class="flex items-center gap-2 text-sm w-full">
                <span>A cada</span>
                <input type="number" min="1" max="31" [ngModel]="dayOfMonthEachValue()" (ngModelChange)="dayOfMonthEachValue.set(+$event)" class="w-20 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono text-center">
                <span>dias</span>
              </div>
            }
            @case('range') {
              <div class="flex items-center gap-2 text-sm w-full">
                <select [ngModel]="dayOfMonthRangeStart()" (ngModelChange)="dayOfMonthRangeStart.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of dayOfMonthOptions; track i) { <option [value]="i">{{i}}</option> }
                </select>
                <span>até</span>
                <select [ngModel]="dayOfMonthRangeEnd()" (ngModelChange)="dayOfMonthRangeEnd.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of dayOfMonthOptions; track i) { <option [value]="i">{{i}}</option> }
                </select>
              </div>
            }
            @case('list') {
               <div class="w-full">
                <input type="text" [ngModel]="dayOfMonthListValue()" (ngModelChange)="dayOfMonthListValue.set($event)" placeholder="ex: 1,15" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono" [class.border-red-500]="dayOfMonthListError()">
                @if(dayOfMonthListError(); as error) {
                  <p class="text-xs text-red-400 mt-1">{{ error }}</p>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- Month -->
      <div class="grid grid-cols-1 md:grid-cols-[100px_1fr_1fr] gap-x-4 gap-y-2 items-center p-3 bg-gray-900/50 rounded-lg">
        <label class="font-medium text-gray-300">Mês</label>
        <select [ngModel]="monthSelectionType()" (ngModelChange)="monthSelectionType.set($event)" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
          <option value="every">Todo Mês (*)</option>
          <option value="each">A cada 'X' Meses (Passo)</option>
          <option value="range">Intervalo de Meses</option>
          <option value="list">Mês(es) Específico(s)</option>
        </select>
        <div class="min-h-[40px] flex items-center">
          @switch(monthSelectionType()) {
            @case('each') {
              <div class="flex items-center gap-2 text-sm w-full">
                <span>A cada</span>
                <input type="number" min="1" max="12" [ngModel]="monthEachValue()" (ngModelChange)="monthEachValue.set(+$event)" class="w-20 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono text-center">
                <span>meses</span>
              </div>
            }
            @case('range') {
              <div class="flex items-center gap-2 text-sm w-full">
                <select [ngModel]="monthRangeStart()" (ngModelChange)="monthRangeStart.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of monthOptions; track i) { <option [value]="i">{{ monthNames[i-1] }}</option> }
                </select>
                <span>até</span>
                <select [ngModel]="monthRangeEnd()" (ngModelChange)="monthRangeEnd.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of monthOptions; track i) { <option [value]="i">{{ monthNames[i-1] }}</option> }
                </select>
              </div>
            }
            @case('list') {
              <div class="w-full">
                <input type="text" [ngModel]="monthListValue()" (ngModelChange)="monthListValue.set($event)" placeholder="ex: 1,6,12" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono" [class.border-red-500]="monthListError()">
                @if(monthListError(); as error) {
                  <p class="text-xs text-red-400 mt-1">{{ error }}</p>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- Day of Week -->
      <div class="grid grid-cols-1 md:grid-cols-[100px_1fr_1fr] gap-x-4 gap-y-2 items-center p-3 bg-gray-900/50 rounded-lg">
        <label class="font-medium text-gray-300">Dia da Semana</label>
        <select [ngModel]="dayOfWeekSelectionType()" (ngModelChange)="dayOfWeekSelectionType.set($event)" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
          <option value="every">Todo Dia da Semana (*)</option>
          <option value="each">A cada 'X' Dias (Passo)</option>
          <option value="range">Intervalo de Dias</option>
          <option value="list">Dia(s) Específico(s)</option>
        </select>
        <div class="min-h-[40px] flex items-center">
          @switch(dayOfWeekSelectionType()) {
            @case('each') {
              <div class="flex items-center gap-2 text-sm w-full">
                <span>A cada</span>
                <input type="number" min="1" max="7" [ngModel]="dayOfWeekEachValue()" (ngModelChange)="dayOfWeekEachValue.set(+$event)" class="w-20 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono text-center">
                <span>dias da semana</span>
              </div>
            }
            @case('range') {
              <div class="flex items-center gap-2 text-sm w-full">
                <select [ngModel]="dayOfWeekRangeStart()" (ngModelChange)="dayOfWeekRangeStart.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of dayOfWeekOptions; track i) { <option [value]="i">{{ dayOfWeekNames[i] }}</option> }
                </select>
                <span>até</span>
                <select [ngModel]="dayOfWeekRangeEnd()" (ngModelChange)="dayOfWeekRangeEnd.set(+$event)" class="flex-1 bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent">
                  @for(i of dayOfWeekOptions; track i) { <option [value]="i">{{ dayOfWeekNames[i] }}</option> }
                </select>
              </div>
            }
            @case('list') {
              <div class="w-full">
                <input type="text" [ngModel]="dayOfWeekListValue()" (ngModelChange)="dayOfWeekListValue.set($event)" placeholder="ex: 1-5 (Seg-Sex)" class="w-full bg-gray-800 border-gray-700 text-white rounded-md p-2 focus:ring-blue-accent focus:border-blue-accent font-mono" [class.border-red-500]="dayOfWeekListError()">
                @if(dayOfWeekListError(); as error) {
                  <p class="text-xs text-red-400 mt-1">{{ error }}</p>
                }
              </div>
            }
          }
        </div>
      </div>
    </div>
  }


  <div class="space-y-4">
    <div>
      <label class="block text-sm font-medium text-gray-400 mb-1">Resultado da Expressão</label>
      <div class="relative">
        <input 
          type="text" 
          readonly 
          [value]="cronString()" 
          class="w-full bg-gray-800 border-gray-700 text-green-accent font-mono rounded-md p-3 pr-12">
        <button (click)="copyToClipboard()" class="absolute inset-y-0 right-0 flex items-center px-3 text-gray-400 hover:text-white">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
        </button>
      </div>
    </div>
     <div>
      <label class="block text-sm font-medium text-gray-400 mb-1">Explicação</label>
      <div class="w-full bg-gray-800 border-gray-700 text-gray-300 rounded-md p-3 min-h-[44px]">
        {{ explanation() }}
      </div>
    </div>
  </div>
</div>

@if(!isEmbedded()) {
  <app-code-usage-tips>
    <div tab="n8n">
      <div class="text-gray-300 space-y-4 text-sm">
        <p>A expressão CRON gerada é perfeita para o nó <code class="bg-gray-800 px-1 py-0.5 rounded">Cron</code> do n8n, que inicia um workflow em um agendamento específico.</p>
        <h4 class="font-semibold text-white mb-2">Como usar:</h4>
        <ol class="list-decimal list-inside space-y-2 pl-2">
            <li>Adicione um nó <strong class="text-white">Cron</strong> ao seu workflow.</li>
            <li>No painel de parâmetros do nó, mude o <strong class="text-white">Mode</strong> para <strong class="text-white">Custom</strong>.</li>
            <li>Copie a expressão CRON desta ferramenta.</li>
            <li>Cole-a no campo <strong class="text-white">Cron Expression</strong>.</li>
        </ol>
        <div class="mt-2 p-3 bg-blue-900/30 border border-blue-700/50 text-blue-300 rounded-lg text-xs">
            <strong class="font-semibold">Dica:</strong> Use o gerador visual para criar agendamentos complexos, como "executar às 14:30 na última sexta-feira de cada mês", e depois apenas copie e cole no n8n.
        </div>
      </div>
    </div>
    <div tab="python">
      <div>
        <p class="text-sm text-gray-400 mb-4">Use a biblioteca <code class="bg-gray-800 px-1 py-0.5 rounded text-gray-300">croniter</code> para calcular as próximas execuções de uma expressão CRON, ou <code class="bg-gray-800 px-1 py-0.5 rounded text-gray-300">apscheduler</code> para agendar tarefas.</p>
        <div class="relative">
          <pre class="bg-gray-800 p-4 rounded-md text-xs text-white overflow-x-auto"><code class="language-python" [textContent]="pythonSnippet()"></code></pre>
          <button (click)="copyCodeSnippet(pythonSnippet())" class="absolute top-2 right-2 text-xs bg-gray-700 hover:bg-gray-600 text-white font-semibold px-2 py-1 rounded">Copiar</button>
        </div>
      </div>
    </div>
    <div tab="javascript">
      <div>
        <p class="text-sm text-gray-400 mb-4">A biblioteca <code class="bg-gray-800 px-1 py-0.5 rounded text-gray-300">node-cron</code> é uma maneira popular de agendar tarefas em aplicações Node.js.</p>
        <div class="relative">
          <pre class="bg-gray-800 p-4 rounded-md text-xs text-white overflow-x-auto"><code class="language-js" [textContent]="javascriptSnippet()"></code></pre>
           <button (click)="copyCodeSnippet(javascriptSnippet())" class="absolute top-2 right-2 text-xs bg-gray-700 hover:bg-gray-600 text-white font-semibold px-2 py-1 rounded">Copiar</button>
        </div>
      </div>
    </div>
  </app-code-usage-tips>
}
