<div class="max-w-7xl mx-auto">
  @if(blogService.loading()) {
    <div class="text-center py-16 text-gray-400">
      <p>Carregando artigo...</p>
    </div>
  } @else if (post(); as p) {
    <article>
      <header class="mb-12 text-center max-w-4xl mx-auto">
        <div class="text-sm text-gray-400 mb-2">
          <a routerLink="/blog" class="hover:text-blue-accent hover:underline">Blog</a> &middot; <span>{{ p.date | date:'dd/MM/yyyy' }}</span>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight">{{ p.title }}</h1>
        <p class="mt-4 text-lg text-gray-400">Por {{ p.author }}</p>
      </header>
      
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12">
        <!-- Main Content -->
        <div class="lg:col-span-8 space-y-8">
          @for (section of mainContent(); track $index) {
            @switch (section.type) {
              @case ('introduction') {
                @let intro = $any(section);
                <section class="text-lg text-gray-300 leading-relaxed border-l-4 border-blue-accent pl-6">
                  <p [innerHTML]="intro.text | safeHtml"></p>
                </section>
              }
              @case ('textBlock') {
                @let block = $any(section);
                <section>
                  @if (block.title) {
                    <h2 class="text-2xl md:text-3xl font-bold text-white mt-8 mb-4 pb-3 border-b border-gray-800">{{ block.title }}</h2>
                  }
                  <div class="prose-container" [innerHTML]="block.text | safeHtml"></div>
                </section>
              }
              @case ('image') {
                @let img = $any(section);
                <figure class="my-8">
                  <img [src]="img.src" alt="{{ img.caption || 'Imagem do post' }}" class="rounded-lg mx-auto block max-w-full h-auto shadow-lg">
                  @if (img.caption) {
                    <figcaption class="text-center text-sm text-gray-500 mt-2">{{ img.caption }}</figcaption>
                  }
                </figure>
              }
              @case ('codeBlock') {
                @let code = $any(section);
                <div class="my-8">
                  <div class="bg-gray-900 border border-gray-800 rounded-t-lg px-4 py-2 text-xs text-gray-400 font-semibold">{{ code.language }}</div>
                  <pre class="bg-gray-900 border border-t-0 border-gray-800 rounded-b-lg p-4 -mt-px overflow-x-auto text-sm"><code [textContent]="code.code"></code></pre>
                </div>
              }
              @case ('topics') {
                @let topics = $any(section);
                <section class="my-10">
                  <h3 class="text-xl font-bold text-white mb-4">{{ topics.title }}</h3>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    @for (item of topics.items; track item) {
                      <div class="bg-gray-900 border border-gray-800 rounded-lg p-4 flex items-start gap-3">
                        <span class="material-icons-outlined text-blue-accent mt-1">check_circle_outline</span>
                        <p class="text-gray-300">{{ item }}</p>
                      </div>
                    }
                  </div>
                </section>
              }
            }
          }
        </div>

        <!-- Sidebar -->
        <aside class="lg:col-span-4 lg:sticky top-24 self-start space-y-8">
          @for (section of sidebarContent(); track $index) {
            @switch (section.type) {
              @case ('tipCard') {
                @let card = $any(section);
                <div class="card-animate bg-gray-900 border rounded-lg p-4 {{ getCardColorClasses(card.variant) }}">
                  <div class="flex items-center gap-3 mb-2">
                    <span class="material-icons-outlined">{{ getCardIcon(card.variant) }}</span>
                    <h4 class="text-lg font-bold text-white">{{ card.title }}</h4>
                  </div>
                  <p class="text-sm text-gray-400 leading-relaxed" [innerHTML]="card.text | safeHtml"></p>
                </div>
              }
              @case ('ad') {
                @let ad = $any(section);
                <div class="card-animate bg-gray-800/50 border border-gray-700 rounded-lg p-4 text-center">
                  <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Publicidade</h4>
                  <div class="bg-gray-700 h-64 w-full flex items-center justify-center rounded">
                    <span class="text-gray-500 text-sm">Espaço Publicitário <br> ({{ ad.slotId }})</span>
                  </div>
                </div>
              }
            }
          }
        </aside>
      </div>
    </article>
  } @else {
    <div class="text-center py-16">
        <h1 class="text-3xl font-bold text-white">Post não encontrado</h1>
        <p class="mt-2 text-gray-400">O artigo que você está procurando não existe ou foi movido.</p>
        <a routerLink="/blog" class="mt-6 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-accent hover:bg-blue-accent/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-blue-accent">
            Voltar para o Blog
        </a>
    </div>
  }
</div>